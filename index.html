<!DOCTYPE html>
<html lang="ms">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Klinik Pergigian Anda</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

<style>
/* ——— CSS kekal sama, hanya logo bertukar ——— */
body { font-family: 'Segoe UI', sans-serif; margin:0; background:#f8f9fa; color:#333; }

.hero {
    background:linear-gradient(135deg,#004aad,#002a70);
    color:white; text-align:center; padding:40px 20px 50px;
    border-radius:0 0 40px 40px;
}
.logo-container { width:120px; height:120px; margin:0 auto 10px; }
.logo-container img { width:100%; height:100%; object-fit:cover; border-radius:10px; }

.intro-card {
    background:white; max-width:600px; margin:-30px auto 20px;
    padding:20px; border-radius:15px; box-shadow:0 5px 20px rgba(0,0,0,0.1);
}
.features-list { list-style:none; padding:0; margin:0 auto 10px; width:fit-content; }
.features-list li { margin:6px 0; font-size:14px; color:#004aad; font-weight:600; }
.btn-main {
    background:#004aad; color:white; padding:14px 35px; border-radius:50px;
    border:none; font-weight:bold; cursor:pointer; text-transform:uppercase;
}

/* slot section */
#jadualWrapper { display:none; max-width:650px; margin:0 auto 40px; padding:0 15px; }
.date-card {
    background:white; padding:15px; margin-bottom:20px; border-radius:12px;
    box-shadow:0 3px 10px rgba(0,0,0,0.05); text-align:center;
}
.slot-card {
    background:white; display:flex; justify-content:space-between; align-items:center;
    padding:15px; margin-bottom:12px; border-radius:10px; border-left:5px solid #004aad;
    box-shadow:0 2px 8px rgba(0,0,0,0.05);
}
.slot-info h4 { margin:0; color:#004aad; }
.btn-slot { padding:10px 20px; border-radius:30px; border:none; font-size:12px; font-weight:bold; }

/* status */
.status-kosong { background:#e3f2fd; color:#004aad; }
.status-pending { background:#fff3cd; color:#8a6d3b; cursor:not-allowed; }
.status-penuh { background:#f8d7da; color:#721c24; cursor:not-allowed; }

/* modal */
.modal {
    position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6);
    display:none; align-items:center; justify-content:center; z-index:999;
}
.modal-box {
    background:white; padding:25px; border-radius:15px; width:90%; max-width:380px;
    box-shadow:0 10px 30px rgba(0,0,0,0.4);
}
</style>
</head>
<body>

<div class="hero">
    <div class="logo-container">
        <img src="logo_klinikanda.jpg" alt="Logo Klinik">
    </div>
    <h1>KLINIK PERGIGIAN ANDA</h1>
    <p style="opacity:.8;">Senyuman Sihat Bermula Di Sini</p>
</div>

<div class="intro-card">
    <p>Rawatan pergigian moden, selamat dan profesional untuk semua peringkat umur.</p>

    <ul class="features-list">
        <li><i class="fas fa-check"></i> Tempahan Online</li>
        <li><i class="fas fa-check"></i> Rawatan Selesa & Selamat</li>
        <li><i class="fas fa-check"></i> Doktor Bertauliah</li>
    </ul>

    <center>
        <button class="btn-main" onclick="toggleJadual()">Lihat Jadual & Tempah</button>
    </center>
</div>

<div id="jadualWrapper">
    <div class="date-card">
        <input type="date" id="dateInput" onchange="loadData()">
    </div>

    <div id="slotList">
        <p align="center"><i class="fas fa-spinner fa-spin"></i> Memuatkan...</p>
    </div>

    <center style="margin-top:20px;">
        <a href="admin.html" style="color:#ff9800; font-weight:bold; font-size:12px;">
            <i class="fas fa-user-shield"></i> Staff Login
        </a>
    </center>
</div>

<!-- MODAL -->
<div id="modalForm" class="modal">
    <div class="modal-box">
        <h3>Butiran Tempahan</h3>
        <p>Tarikh: <span id="dDate"></span><br>
        Masa: <span id="dTime"></span><br>
        Rawatan: <span id="dService"></span></p>

        <input id="inpNama" class="form-input" placeholder="Nama">
        <input id="inpPhone" class="form-input" placeholder="No Telefon (6012...)">
        <input id="inpMasalah" class="form-input" placeholder="Masalah">

        <button class="btn-main" onclick="submitBooking()">Hantar Tempahan</button>
        <button class="btn-slot" onclick="closeModal()">Batal</button>
    </div>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbxw7jOX0MnBN2-KD6KT3lbt7liDItNs5rtLLci486Iy0hEDYcXjfE7WKOaYQJnWd1xz/exec";

document.getElementById("dateInput").value = new Date().toISOString().split("T")[0];

function toggleJadual(){
    let w = document.getElementById("jadualWrapper");
    w.style.display = (w.style.display === "block") ? "none" : "block";
    if(w.style.display === "block") loadData();
}

async function loadData(){
    let date = document.getElementById("dateInput").value;
    let box = document.getElementById("slotList");
    box.innerHTML = "<p align='center'>Loading...</p>";

    let res = await fetch(API_URL + "?date=" + date);
    let data = await res.json();
    renderList(data.jadual);
}

function renderList(list){
    let box = document.getElementById("slotList");
    box.innerHTML = "";

    list.forEach(i=>{
        let d = i.data || {};
        let status = d.status || "kosong";

        let btnText = "TEMPAH";
        let btnClass = "status-kosong";
        let action = `openModal('${i.service}', '${i.masa}')`;

        if(status==="PENDING"){ btnText="DIPROSES"; btnClass="status-pending"; action=""; }
        if(status==="CONFIRMED"){ btnText="PENUH"; btnClass="status-penuh"; action=""; }

        box.innerHTML += `
            <div class="slot-card">
                <div class="slot-info">
                    <h4>${i.service}</h4>
                    <p>${i.masa}</p>
                </div>
                <button class="btn-slot ${btnClass}" onclick="${action}">${btnText}</button>
            </div>`;
    });
}

let selected = {};

function openModal(svc,time){
    selected = {svc,time};
    document.getElementById("dService").innerText = svc;
    document.getElementById("dTime").innerText = time;
    document.getElementById("dDate").innerText = document.getElementById("dateInput").value;
    document.getElementById("modalForm").style.display = "flex";
}

function closeModal(){
    document.getElementById("modalForm").style.display = "none";
}

async function submitBooking(){
    let nama = inpNama.value;
    let phone = inpPhone.value;
    let masalah = inpMasalah.value;

    if(!nama || !phone || !masalah){ alert("Lengkapkan semua."); return; }

    let cleanPhone = phone.replace(/\D/g,'');
    if(cleanPhone.startsWith("0")) cleanPhone = "60" + cleanPhone.substring(1);
    else if(!cleanPhone.startsWith("60")) cleanPhone = "60" + cleanPhone;

    await fetch(API_URL, {
        method:"POST",
        body:JSON.stringify({
            type:"BOOKING",
            date:document.getElementById("dateInput").value,
            masa:selected.time,
            masalah,
            nama,
            phone:cleanPhone
        })
    });

    window.open("https://wa.me/601112601715?text=" + encodeURIComponent(
        `Hai, saya mahu tempah:\nTarikh: ${dDate.innerText}\nMasa: ${selected.time}\nNama: ${nama}\nTel: ${cleanPhone}\nMasalah: ${masalah}`
    ));

    closeModal();
    loadData();
}
</script>
</body>
</html>
